<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Calendar Logistics Optimizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    <style>
        /* Simple loader animation */
        .loader {
            border-top-color: #3498db;
            animation: spinner 1.5s linear infinite;
        }

        @keyframes spinner {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* Custom transition for a smoother effect */
        .transition-all-smooth {
            transition: all 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        // --- Icon Components (replaces lucide-react) ---
        const Icon = ({ size = 16, children, className }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width={size}
                height={size}
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="2"
                strokeLinecap="round"
                strokeLinejoin="round"
                className={className}
            >
                {children}
            </svg>
        );

        const ArrowRight = ({ size }) => <Icon size={size}><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></Icon>;
        const Zap = ({ size, className }) => <Icon size={size} className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></Icon>;
        const Leaf = ({ size, className }) => <Icon size={size} className={className}><path d="M11 20A7 7 0 0 1 4 13c0-3.9 3.1-7 7-7s7 3.1 7 7-3.1 7-7 7z"></path><path d="M12 4v16"></path></Icon>;
        const MapPin = ({ size, className }) => <Icon size={size} className={className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></Icon>;
        const Milestone = ({ size, className }) => <Icon size={size} className={className}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" y1="22" x2="4" y2="15"></line></Icon>;

        // --- Helper Functions ---
        const calculateDistance = (lat1, lon1, lat2, lon2) => {
            const R = 6371; // Radius of the Earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        };

        const calculateCalendarStats = (calendar, emissionRate) => {
            let totalDistance = 0;
            const segments = [];

            for (let i = 0; i < calendar.length - 1; i++) {
                const fromRace = calendar[i];
                const toRace = calendar[i + 1];
                const distance = calculateDistance(fromRace.latitude, fromRace.longitude, toRace.latitude, toRace.longitude);
                totalDistance += distance;
                segments.push({
                    from: fromRace.city,
                    to: toRace.city,
                    distance: distance
                });
            }
            const totalEmissions = totalDistance * emissionRate;
            return { totalDistance, totalEmissions, segments };
        };

        // --- React Components ---
        const RaceCard = ({ race, index, isFirst, isLast, distanceToNext, segment }) => {
            return (
                <div className="mb-2 group">
                    <div className="flex items-center">
                        <div className={`flex-shrink-0 w-12 h-12 rounded-full ${isFirst ? 'bg-green-500' : 'bg-blue-500'} text-white flex items-center justify-center font-bold text-lg transition-all-smooth group-hover:scale-110`}>
                            {index + 1}
                        </div>
                        <div className="ml-4 flex-grow">
                            <div className="flex items-center">
                                <img src={`https://flagsapi.com/${race.countryCode}/flat/32.png`} alt={`${race.country} flag`} className="w-8 h-8 mr-3 rounded-md"/>
                                <div>
                                    <h4 className="font-bold text-md text-gray-200">{race.country}</h4>
                                    <p className="text-sm text-gray-400">{race.city} - <span className="italic">{race.circuit_name}</span></p>
                                </div>
                            </div>
                        </div>
                        <img src={race.trackImage} alt={`${race.circuit_name}`} className="w-24 h-16 rounded-lg object-cover ml-4 transition-all-smooth group-hover:shadow-lg group-hover:shadow-cyan-500/50"/>
                    </div>
                    {!isLast && segment && (
                        <div className="ml-6 mt-2 pl-px flex items-center transition-all-smooth opacity-0 group-hover:opacity-100">
                            <div className="border-l-2 border-dashed border-gray-600 h-8"></div>
                            <div className="ml-4 flex items-center space-x-2 text-gray-400 text-xs">
                                <ArrowRight size={14} />
                                <span>To {segment.to}</span>
                                <span className="font-semibold text-gray-200">{Math.round(distanceToNext).toLocaleString()} km</span>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const CalendarDisplay = ({ title, calendar, stats, icon }) => {
            return (
                <div className="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 w-full transform hover:-translate-y-1 transition-all-smooth">
                    <div className="flex items-center mb-6">
                        {icon}
                        <h2 className="text-2xl font-bold text-gray-100 ml-3">{title}</h2>
                    </div>
                    <div className="space-y-4 mb-6">
                        {calendar.map((race, index) => (
                            <RaceCard
                                key={`${race.id}-${index}`}
                                race={race}
                                index={index}
                                isFirst={index === 0}
                                isLast={index === calendar.length - 1}
                                distanceToNext={stats.segments[index]?.distance}
                                segment={stats.segments[index]}
                            />
                        ))}
                    </div>
                    <div className="bg-gray-700 p-4 rounded-lg mt-6 border border-gray-600">
                        <h3 className="font-bold text-lg text-gray-200 mb-3">Logistics Summary</h3>
                        <div className="space-y-2">
                            <div className="flex justify-between items-center text-md">
                                <span className="text-gray-400 flex items-center"><Milestone size={16} className="mr-2" />Total Distance:</span>
                                <span className="font-bold text-blue-400 text-lg">{Math.round(stats.totalDistance).toLocaleString()} km</span>
                            </div>
                            <div className="flex justify-between items-center text-md">
                                <span className="text-gray-400 flex items-center"><Leaf size={16} className="mr-2" />Total CO₂ Emissions:</span>
                                <span className="font-bold text-green-400 text-lg">{Math.round(stats.totalEmissions).toLocaleString()} kg</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const SavingsChart = ({ data }) => {
            return (
                <div className="my-8 p-6 bg-gray-800 border-2 border-gray-700 rounded-2xl shadow-lg">
                    <h2 className="text-2xl font-bold text-green-400 mb-4 text-center">CO₂ Emission Comparison</h2>
                    <ResponsiveContainer width="100%" height={400}>
                        <AreaChart data={data} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>
                            <CartesianGrid strokeDasharray="3 3" stroke="#4A5568" />
                            <XAxis dataKey="name" stroke="#A0AEC0" />
                            <YAxis stroke="#A0AEC0" />
                            <Tooltip
                                contentStyle={{ backgroundColor: '#2D3748', border: '1px solid #4A5568' }}
                                labelStyle={{ color: '#E2E8F0' }}
                            />
                            <Legend wrapperStyle={{ color: '#E2E8F0' }} />
                            <Area type="monotone" dataKey="Original" stroke="#F56565" fillOpacity={0.4} fill="#F56565" />
                            <Area type="monotone" dataKey="Optimized" stroke="#48BB78" fillOpacity={0.4} fill="#48BB78" />
                        </AreaChart>
                    </ResponsiveContainer>
                </div>
            );
        };

        const App = () => {
            const { useState, useMemo } = React;

            const [initialRaces, setInitialRaces] = useState([
                 // 2025 F1 Calendar Data (provisional) with country codes and image URLs
                { id: 1, country: 'Australia', countryCode: 'AU', city: 'Melbourne', circuit_name: 'Albert Park', latitude: -37.8497, longitude: 144.968, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Australia_Circuit.png' },
                { id: 2, country: 'China', countryCode: 'CN', city: 'Shanghai', circuit_name: 'Shanghai Circuit', latitude: 31.3389, longitude: 121.2206, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/China_Circuit.png' },
                { id: 3, country: 'Japan', countryCode: 'JP', city: 'Suzuka', circuit_name: 'Suzuka Circuit', latitude: 34.8431, longitude: 136.5411, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Japan_Circuit.png' },
                { id: 4, country: 'Bahrain', countryCode: 'BH', city: 'Sakhir', circuit_name: 'Bahrain Circuit', latitude: 26.0325, longitude: 50.5106, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Bahrain_Circuit.png' },
                { id: 5, country: 'Saudi Arabia', countryCode: 'SA', city: 'Jeddah', circuit_name: 'Jeddah Corniche', latitude: 21.6333, longitude: 39.1044, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Saudi_Arabia_Circuit.png' },
                { id: 6, country: 'USA', countryCode: 'US', city: 'Miami', circuit_name: 'Miami Autodrome', latitude: 25.9581, longitude: -80.2389, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Miami_Circuit.png' },
                { id: 7, country: 'Italy', countryCode: 'IT', city: 'Imola', circuit_name: 'Imola Circuit', latitude: 44.3439, longitude: 11.7167, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Emilia_Romagna_Circuit.png' },
                { id: 8, country: 'Monaco', countryCode: 'MC', city: 'Monaco', circuit_name: 'Circuit de Monaco', latitude: 43.7347, longitude: 7.4206, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Monoco_Circuit.png' },
                { id: 9, country: 'Spain', countryCode: 'ES', city: 'Barcelona', circuit_name: 'Circuit de Barcelona-Catalunya', latitude: 41.5700, longitude: 2.2611, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Spain_Circuit.png' },
                { id: 10, country: 'Canada', countryCode: 'CA', city: 'Montreal', circuit_name: 'Circuit Gilles Villeneuve', latitude: 45.5000, longitude: -73.5222, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Canada_Circuit.png' },
                { id: 11, country: 'Austria', countryCode: 'AT', city: 'Spielberg', circuit_name: 'Red Bull Ring', latitude: 47.2197, longitude: 14.7647, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Austria_Circuit.png' },
                { id: 12, country: 'UK', countryCode: 'GB', city: 'Silverstone', circuit_name: 'Silverstone Circuit', latitude: 52.0786, longitude: -1.0169, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Great_Britain_Circuit.png' },
                { id: 13, country: 'Belgium', countryCode: 'BE', city: 'Spa', circuit_name: 'Spa-Francorchamps', latitude: 50.4372, longitude: 5.9714, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Belgium_Circuit.png' },
                { id: 14, country: 'Hungary', countryCode: 'HU', city: 'Budapest', circuit_name: 'Hungaroring', latitude: 47.5789, longitude: 19.2486, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Hungary_Circuit.png' },
                { id: 15, country: 'Netherlands', countryCode: 'NL', city: 'Zandvoort', circuit_name: 'Circuit Zandvoort', latitude: 52.3888, longitude: 4.5409, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Netherlands_Circuit.png' },
                { id: 16, country: 'Italy', countryCode: 'IT', city: 'Monza', circuit_name: 'Autodromo Nazionale Monza', latitude: 45.6156, longitude: 9.2811, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Italy_Circuit.png' },
                { id: 17, country: 'Azerbaijan', countryCode: 'AZ', city: 'Baku', circuit_name: 'Baku City Circuit', latitude: 40.3725, longitude: 49.8533, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Azerbaijan_Circuit.png' },
                { id: 18, country: 'Singapore', countryCode: 'SG', city: 'Singapore', circuit_name: 'Marina Bay Street Circuit', latitude: 1.2914, longitude: 103.8644, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Singapore_Circuit.png' },
                { id: 19, country: 'USA', countryCode: 'US', city: 'Austin', circuit_name: 'Circuit of the Americas', latitude: 30.1328, longitude: -97.6411, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/USA_Circuit.png' },
                { id: 20, country: 'Mexico', countryCode: 'MX', city: 'Mexico City', circuit_name: 'Autódromo Hermanos Rodríguez', latitude: 19.4042, longitude: -99.0907, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Mexico_Circuit.png' },
                { id: 21, country: 'Brazil', countryCode: 'BR', city: 'São Paulo', circuit_name: 'Interlagos Circuit', latitude: -23.7036, longitude: -46.6997, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Brazil_Circuit.png' },
                { id: 22, country: 'USA', countryCode: 'US', city: 'Las Vegas', circuit_name: 'Las Vegas Strip Circuit', latitude: 36.1147, longitude: -115.1728, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Las_Vegas_Circuit.png' },
                { id: 23, country: 'Qatar', countryCode: 'QA', city: 'Lusail', circuit_name: 'Lusail International Circuit', latitude: 25.4900, longitude: 51.4542, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Qatar_Circuit.png' },
                { id: 24, country: 'Abu Dhabi', countryCode: 'AE', city: 'Yas Island', circuit_name: 'Yas Marina Circuit', latitude: 24.4672, longitude: 54.6031, trackImage: 'https://www.formula1.com/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Abu_Dhabi_Circuit.png' }
            ]);
            const [optimizedCalendar, setOptimizedCalendar] = useState(null);
            const [emissionRate, setEmissionRate] = useState(0.6); // kg CO2 per km
            const [isOptimizing, setIsOptimizing] = useState(false);

            const originalStats = useMemo(() => calculateCalendarStats(initialRaces, emissionRate), [initialRaces, emissionRate]);
            const optimizedStats = useMemo(() => optimizedCalendar ? calculateCalendarStats(optimizedCalendar, emissionRate) : null, [optimizedCalendar, emissionRate]);

            const runOptimization = () => {
                setIsOptimizing(true);
                setTimeout(() => {
                    let unvisited = [...initialRaces];
                    let currentRace = unvisited.shift();
                    const newCalendar = [currentRace];

                    while (unvisited.length > 0) {
                        let nearestIndex = -1;
                        let minDistance = Infinity;

                        for (let i = 0; i < unvisited.length; i++) {
                            const distance = calculateDistance(
                                currentRace.latitude, currentRace.longitude,
                                unvisited[i].latitude, unvisited[i].longitude
                            );
                            if (distance < minDistance) {
                                minDistance = distance;
                                nearestIndex = i;
                            }
                        }
                        currentRace = unvisited.splice(nearestIndex, 1)[0];
                        newCalendar.push(currentRace);
                    }

                    setOptimizedCalendar(newCalendar);
                    setIsOptimizing(false);
                }, 500);
            };

            const emissionSavings = optimizedStats ? originalStats.totalEmissions - optimizedStats.totalEmissions : 0;
            const distanceSavings = optimizedStats ? originalStats.totalDistance - optimizedStats.totalDistance : 0;
            const percentageSavings = optimizedStats ? (emissionSavings / originalStats.totalEmissions) * 100 : 0;

            const chartData = useMemo(() => {
                if (!optimizedStats) return [];
                return [
                    { name: 'Original', Original: originalStats.totalEmissions.toFixed(0) },
                    { name: 'Optimized', Optimized: optimizedStats.totalEmissions.toFixed(0) }
                ];
            }, [originalStats, optimizedStats]);

            return (
                <div className="font-sans p-4 sm:p-6 lg:p-8">
                    <div className="max-w-7xl mx-auto">
                        <header className="text-center mb-8 animate-fade-in-down">
                            <h1 className="text-4xl md:text-5xl font-extrabold text-gray-100 tracking-tight">F1 Calendar Logistics Optimizer 🏎️</h1>
                            <p className="mt-3 text-lg text-gray-400 max-w-3xl mx-auto">
                                Analyzing the 2025 F1 schedule to find a more efficient, geographically-grouped calendar and reduce the carbon footprint from logistics.
                            </p>
                        </header>

                        <div className="flex flex-col sm:flex-row justify-center items-center gap-4 mb-8 p-6 bg-gray-800 rounded-2xl shadow-lg border border-gray-700">
                            <div className="flex-grow">
                                <label htmlFor="emissionRate" className="block text-sm font-medium text-gray-300 mb-1">Emission Rate (kg CO₂ per km)</label>
                                <input
                                    type="number"
                                    id="emissionRate"
                                    value={emissionRate}
                                    onChange={(e) => setEmissionRate(parseFloat(e.target.value) || 0)}
                                    className="w-full p-2 border border-gray-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-white"
                                />
                            </div>
                            <button
                                onClick={runOptimization}
                                disabled={isOptimizing}
                                className="w-full sm:w-auto bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all-smooth disabled:bg-gray-500 disabled:cursor-not-allowed flex items-center justify-center transform hover:scale-105"
                            >
                                <Zap size={20} className="mr-2" />
                                {isOptimizing ? 'Optimizing...' : 'Optimize Calendar'}
                            </button>
                        </div>

                        {optimizedStats && (
                            <div className="mb-8 p-6 bg-green-900 border-2 border-green-700 rounded-2xl shadow-lg text-center transform hover:scale-105 transition-all-smooth">
                                <h2 className="text-2xl font-bold text-green-300">Optimization Complete!</h2>
                                <p className="text-green-400 mt-2 text-lg">
                                    By reordering the calendar, we can achieve a <strong className="text-4xl font-extrabold">{percentageSavings.toFixed(1)}%</strong> reduction in logistics emissions.
                                </p>
                                <div className="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                                    <div className="bg-gray-800 p-4 rounded-lg border border-gray-700">
                                        <h4 className="font-bold text-gray-300">Distance Saved</h4>
                                        <p className="text-2xl font-bold text-blue-400">{Math.round(distanceSavings).toLocaleString()} km</p>
                                    </div>
                                    <div className="bg-gray-800 p-4 rounded-lg border border-gray-700">
                                        <h4 className="font-bold text-gray-300">Emissions Saved</h4>
                                        <p className="text-2xl font-bold text-green-400">{Math.round(emissionSavings).toLocaleString()} kg CO₂</p>
                                    </div>
                                </div>
                                <SavingsChart data={chartData} />
                            </div>
                        )}

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                            <CalendarDisplay
                                title="Original 2025 Calendar"
                                calendar={initialRaces}
                                stats={originalStats}
                                icon={<MapPin size={28} className="text-red-500" />}
                            />
                            {isOptimizing && (
                                <div className="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 w-full flex flex-col justify-center items-center h-full min-h-[500px]">
                                    <div className="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-24 w-24 mb-4"></div>
                                    <h3 className="text-xl font-semibold text-gray-300">Calculating optimal route...</h3>
                                </div>
                            )}
                            {optimizedCalendar && optimizedStats && (
                                <CalendarDisplay
                                    title="Optimized Calendar"
                                    calendar={optimizedCalendar}
                                    stats={optimizedStats}
                                    icon={<Leaf size={28} className="text-green-500" />}
                                />
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));

    </script>
</body>
</html>
